{"version":3,"sources":["src/server/accessors/Notifier.ts"],"names":[],"mappings":";;;;;;;;;;;;AAEA,oEAAmE;AAKnE,qDAAkD;AAElD,MAAa,QAAQ;IACjB,YAA6B,UAAsB,EAAmB,SAAwB,EAAmB,KAAa;QAAjG,eAAU,GAAV,UAAU,CAAY;QAAmB,cAAS,GAAT,SAAS,CAAe;QAAmB,UAAK,GAAL,KAAK,CAAQ;IAAG,CAAC;IAErH,UAAU,CAAC,IAAW,EAAE,OAAiB;;YAClD,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE;gBACvC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAE/D,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC;aAC5B;YAED,MAAM,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACjE,CAAC;KAAA;IAEY,UAAU,CAAC,IAAW,EAAE,OAAiB;;YAClD,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE;gBACvC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAE/D,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC;aAC5B;YAED,MAAM,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACjE,CAAC;KAAA;IAEY,MAAM,CAAC,OAAuB;;YACvC,OAAO,CAAC,KAAK,GAAG,OAAO,CAAC,KAAK,IAAI,uBAAW,CAAC,IAAI,CAAC;YAElD,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE;gBACnB,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC/D,OAAO,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;aACtD;YAED,IAAI,CAAC,SAAS,CAAC,QAAQ,iCAAM,OAAO,KAAE,QAAQ,EAAE,IAAI,KAAI,IAAI,CAAC,KAAK,CAAC,CAAC;YAEpE,OAAO,GAAG,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,iCAAM,OAAO,KAAE,QAAQ,EAAE,KAAK,KAAI,IAAI,CAAC,KAAK,CAAC,CAAC;QACtF,CAAC;KAAA;IAEM,iBAAiB;QACpB,OAAO,IAAI,+BAAc,EAAE,CAAC;IAChC,CAAC;CACJ;AAvCD,4BAuCC","file":"Notifier.js","sourcesContent":["import type { IMessageBuilder, INotifier } from '../../definition/accessors';\nimport type { ITypingOptions } from '../../definition/accessors/INotifier';\nimport { TypingScope } from '../../definition/accessors/INotifier';\nimport type { IMessage } from '../../definition/messages';\nimport type { IRoom } from '../../definition/rooms';\nimport type { IUser } from '../../definition/users';\nimport type { MessageBridge, UserBridge } from '../bridges';\nimport { MessageBuilder } from './MessageBuilder';\n\nexport class Notifier implements INotifier {\n    constructor(private readonly userBridge: UserBridge, private readonly msgBridge: MessageBridge, private readonly appId: string) {}\n\n    public async notifyUser(user: IUser, message: IMessage): Promise<void> {\n        if (!message.sender || !message.sender.id) {\n            const appUser = await this.userBridge.doGetAppUser(this.appId);\n\n            message.sender = appUser;\n        }\n\n        await this.msgBridge.doNotifyUser(user, message, this.appId);\n    }\n\n    public async notifyRoom(room: IRoom, message: IMessage): Promise<void> {\n        if (!message.sender || !message.sender.id) {\n            const appUser = await this.userBridge.doGetAppUser(this.appId);\n\n            message.sender = appUser;\n        }\n\n        await this.msgBridge.doNotifyRoom(room, message, this.appId);\n    }\n\n    public async typing(options: ITypingOptions): Promise<() => Promise<void>> {\n        options.scope = options.scope || TypingScope.Room;\n\n        if (!options.username) {\n            const appUser = await this.userBridge.doGetAppUser(this.appId);\n            options.username = (appUser && appUser.name) || '';\n        }\n\n        this.msgBridge.doTyping({ ...options, isTyping: true }, this.appId);\n\n        return () => this.msgBridge.doTyping({ ...options, isTyping: false }, this.appId);\n    }\n\n    public getMessageBuilder(): IMessageBuilder {\n        return new MessageBuilder();\n    }\n}\n"]}